<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoreo de Bots | Vortex</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/bots.css">
</head>

<body class="dashboard-body">

    <div id="app">
        <!-- Main Bots Section -->
        <section id="bots-section" class="active-section">
            <nav class="navbar glass-panel">
                <div class="logo">Vortex Bots</div>
                <div class="nav-links">
                    <a href="dashboard.html" class="nav-link">üì∞ Noticias</a>
                    <a href="bots.html" class="nav-link active">ü§ñ Bots</a>
                </div>
                <div class="user-controls">
                    <span id="welcome-msg">Cargando...</span>
                    <button id="logout-btn" class="btn-text">Cerrar Sesi√≥n</button>
                </div>
            </nav>

            <div class="content-wrapper">
                <header class="page-header">
                    <h2>Monitoreo de Bots y Procesos</h2>
                    <p>Estado en tiempo real de todos los procesos automatizados</p>
                </header>

                <!-- Admin Controls -->
                <div id="admin-controls" class="admin-controls hidden">
                    <button id="create-bot-btn" class="btn-primary">+ Nuevo Bot</button>
                    <button id="create-incident-btn" class="btn-secondary">üìã Reportar Incidente</button>
                    <button id="manage-subscriptions-btn" class="btn-secondary">üîî Mis Suscripciones</button>
                </div>

                <!-- Status Summary -->
                <div class="status-summary">
                    <div class="status-card operativo">
                        <div class="status-icon">üü¢</div>
                        <div class="status-info">
                            <h3 id="count-operativo">0</h3>
                            <p>Operativos</p>
                        </div>
                    </div>
                    <div class="status-card observacion">
                        <div class="status-icon">üü°</div>
                        <div class="status-info">
                            <h3 id="count-observacion">0</h3>
                            <p>En Observaci√≥n</p>
                        </div>
                    </div>
                    <div class="status-card caido">
                        <div class="status-icon">üî¥</div>
                        <div class="status-info">
                            <h3 id="count-caido">0</h3>
                            <p>Ca√≠dos</p>
                        </div>
                    </div>
                    <div class="status-card total">
                        <div class="status-icon">üìä</div>
                        <div class="status-info">
                            <h3 id="count-total">0</h3>
                            <p>Total Bots</p>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filter-section">
                    <div class="filter-group">
                        <label>Sistema:</label>
                        <select id="system-filter">
                            <option value="">Todos</option>
                            <option value="SAP">SAP</option>
                            <option value="DIAN">DIAN</option>
                            <option value="Power BI">Power BI</option>
                            <option value="UiPath">UiPath</option>
                            <option value="Power Automate">Power Automate</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Estado:</label>
                        <select id="status-filter">
                            <option value="">Todos</option>
                            <option value="operativo">üü¢ Operativo</option>
                            <option value="observacion">üü° En Observaci√≥n</option>
                            <option value="caido">üî¥ Ca√≠do</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Ambiente:</label>
                        <select id="environment-filter">
                            <option value="">Todos</option>
                            <option value="Producci√≥n">Producci√≥n</option>
                            <option value="Desarrollo">Desarrollo</option>
                            <option value="QA">QA</option>
                        </select>
                    </div>
                    <button id="clear-bot-filters" class="btn-secondary">Limpiar Filtros</button>
                </div>

                <!-- Bots Grid -->
                <div id="bots-grid" class="bots-grid">
                    <div class="loading-spinner">Cargando bots...</div>
                </div>

                <!-- Incidents Timeline Section -->
                <div class="section-header">
                    <h2>üìÖ Historial de Incidentes</h2>
                    <div class="timeline-filters">
                        <select id="timeline-bot-filter">
                            <option value="">Todos los Bots</option>
                        </select>
                        <select id="timeline-period-filter">
                            <option value="7">√öltimos 7 d√≠as</option>
                            <option value="30" selected>√öltimos 30 d√≠as</option>
                            <option value="90">√öltimos 90 d√≠as</option>
                            <option value="all">Todo el historial</option>
                        </select>
                    </div>
                </div>

                <div id="incidents-timeline" class="incidents-timeline">
                    <div class="loading-spinner">Cargando incidentes...</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal for Bot Create/Edit -->
    <div id="bot-modal" class="modal hidden">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2 id="bot-modal-title">Nuevo Bot</h2>
            <form id="bot-form">
                <input type="hidden" id="bot-id">
                <div class="input-group">
                    <label for="bot-name">Nombre del Bot *</label>
                    <input type="text" id="bot-name" required>
                </div>
                <div class="input-group">
                    <label for="bot-description">Descripci√≥n</label>
                    <textarea id="bot-description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label for="bot-system">Sistema *</label>
                        <input type="text" id="bot-system" placeholder="Ej: SAP, DIAN, UiPath" required>
                    </div>
                    <div class="input-group">
                        <label for="bot-environment">Ambiente *</label>
                        <select id="bot-environment" required>
                            <option value="Producci√≥n">Producci√≥n</option>
                            <option value="Desarrollo">Desarrollo</option>
                            <option value="QA">QA</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label for="bot-status">Estado *</label>
                    <select id="bot-status" required>
                        <option value="operativo">üü¢ Operativo</option>
                        <option value="observacion">üü° En Observaci√≥n</option>
                        <option value="caido">üî¥ Ca√≠do</option>
                    </select>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label for="bot-responsible-name">Responsable</label>
                        <input type="text" id="bot-responsible-name" placeholder="Nombre completo">
                    </div>
                    <div class="input-group">
                        <label for="bot-responsible-email">Email del Responsable</label>
                        <input type="email" id="bot-responsible-email" placeholder="email@empresa.com">
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary close-modal-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Incident Create/Edit -->
    <div id="incident-modal" class="modal hidden">
        <div class="modal-content glass-panel" style="max-width: 700px;">
            <span class="close-modal">&times;</span>
            <h2 id="incident-modal-title">Reportar Incidente</h2>
            <form id="incident-form">
                <input type="hidden" id="incident-id">
                <div class="input-group">
                    <label for="incident-bot">Bot Afectado *</label>
                    <select id="incident-bot" required>
                        <option value="">Seleccionar bot...</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="incident-title">T√≠tulo del Incidente *</label>
                    <input type="text" id="incident-title" required>
                </div>
                <div class="input-group">
                    <label for="incident-description">Descripci√≥n</label>
                    <textarea id="incident-description" rows="3"></textarea>
                </div>
                <div class="form-row">
                    <div class="input-group">
                        <label for="incident-impact">Nivel de Impacto *</label>
                        <select id="incident-impact" required>
                            <option value="Bajo">Bajo</option>
                            <option value="Medio" selected>Medio</option>
                            <option value="Alto">Alto</option>
                            <option value="Cr√≠tico">Cr√≠tico</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="incident-status">Estado *</label>
                        <select id="incident-status" required>
                            <option value="Abierto" selected>Abierto</option>
                            <option value="En Progreso">En Progreso</option>
                            <option value="Resuelto">Resuelto</option>
                            <option value="Cerrado">Cerrado</option>
                        </select>
                    </div>
                </div>
                <div class="input-group">
                    <label for="incident-root-cause">Causa Ra√≠z</label>
                    <textarea id="incident-root-cause" rows="2" placeholder="¬øQu√© caus√≥ el incidente?"></textarea>
                </div>
                <div class="input-group">
                    <label for="incident-resolution">Resoluci√≥n</label>
                    <textarea id="incident-resolution" rows="2" placeholder="¬øC√≥mo se resolvi√≥?"></textarea>
                </div>
                <div class="input-group">
                    <label for="incident-lessons">Lecciones Aprendidas</label>
                    <textarea id="incident-lessons" rows="2"
                        placeholder="¬øQu√© aprendimos de este incidente?"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary close-modal-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar Incidente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for Subscriptions -->
    <div id="subscription-modal" class="modal hidden">
        <div class="modal-content glass-panel">
            <span class="close-modal">&times;</span>
            <h2>üîî Configurar Suscripciones</h2>
            <form id="subscription-form">
                <div class="subscription-section">
                    <h3>Tipos de Notificaciones</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="sub-news">
                            <span>üì∞ Nuevas noticias publicadas</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="sub-bot-status">
                            <span>ü§ñ Cambios de estado en bots</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="sub-incidents">
                            <span>‚ö†Ô∏è Nuevos incidentes reportados</span>
                        </label>
                    </div>
                </div>

                <div class="subscription-section">
                    <h3>Categor√≠as de Noticias</h3>
                    <p class="hint">Selecciona las categor√≠as de noticias que te interesan:</p>
                    <div class="checkbox-group">
                        <label><input type="checkbox" class="news-category-check" value="Bots"> ü§ñ Bots</label>
                    </div>
                    <div class="checkbox-group">
                        <label><input type="checkbox" class="news-category-check" value="Incidentes"> ‚ö†Ô∏è
                            Incidentes</label>
                    </div>
                    <div class="checkbox-group">
                        <label><input type="checkbox" class="news-category-check" value="Mejoras"> ‚ú® Mejoras</label>
                    </div>
                    <div class="checkbox-group">
                        <label><input type="checkbox" class="news-category-check" value="Release"> üöÄ Release</label>
                    </div>
                    <div class="checkbox-group">
                        <label><input type="checkbox" class="news-category-check" value="Comunicados"> üì¢
                            Comunicados</label>
                    </div>
                </div>

                <div class="subscription-section">
                    <h3>Canales de Notificaci√≥n</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="notify-email" checked>
                            <span>üìß Email</span>
                        </label>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="notify-teams">
                            <span>üí¨ Microsoft Teams</span>
                        </label>
                    </div>
                    <div class="input-group" id="teams-webhook-group" style="display: none; margin-left: 30px;">
                        <label for="teams-webhook">Teams Webhook URL</label>
                        <input type="url" id="teams-webhook" placeholder="https://...">
                        <small style="color: var(--text-muted); font-size: 0.85rem;">
                            <a href="https://learn.microsoft.com/es-es/microsoftteams/platform/webhooks-and-connectors/how-to/add-incoming-webhook"
                                target="_blank" style="color: var(--primary-color);">
                                ¬øC√≥mo obtener un webhook de Teams?
                            </a>
                        </small>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary close-modal-btn">Cancelar</button>
                    <button type="submit" class="btn-primary">Guardar Suscripciones</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="assets/js/config.js"></script>
    <script src="assets/js/bots.js"></script>
</body>

</html>